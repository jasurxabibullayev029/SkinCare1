<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - Debug & Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            line-height: 1.6;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        button {
            padding: 12px 20px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #results { margin-top: 15px; padding: 10px; background: rgba(0, 0, 0, 0.2); border-radius: 5px; }
        pre { background: rgba(0, 0, 0, 0.3); padding: 10px; border-radius: 5px; overflow-x: auto; }
        .steps {
            background: rgba(255, 255, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffeb3b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß AI Chat - Debug & Test</h1>

        <div class="test-section">
            <h3 style="color: #4CAF50;">üéâ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!</h3>
            <p><strong>–û—à–∏–±–∫–∞ "‚ùå –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑." –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è!</strong></p>
            <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —á–∞—Ç–∞.</p>
            <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –Ω–∏–∂–µ.</p>
        </div>

        <div class="steps">
            <h3>üìã –®–∞–≥–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</h3>
            <ol>
                <li><strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:</strong> <code>python manage.py runserver</code></li>
                <li><strong>–û—Ç–∫—Ä–æ–π—Ç–µ:</strong> <a href="http://127.0.0.1:8000/login/" style="color: #ffeb3b;">http://127.0.0.1:8000/login/</a></li>
                <li><strong>–í–æ–π–¥–∏—Ç–µ:</strong> admin / admin123</li>
                <li><strong>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —á–∞—Ç:</strong> <a href="http://127.0.0.1:8000/chatbot/" style="color: #ffeb3b;">http://127.0.0.1:8000/chatbot/</a></li>
                <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å:</strong> F12 ‚Üí Console (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏)</li>
                <li><strong>–ù–∞–ø–∏—à–∏—Ç–µ:</strong> "–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ–∂—É –æ—Ç —Å–æ–ª–Ω—Ü–∞?"</li>
                <li><strong>–û—Ç–ø—Ä–∞–≤—å—Ç–µ:</strong> Enter –∏–ª–∏ –∫–Ω–æ–ø–∫–∞</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üß™ –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–µ—Å—Ç—ã</h3>
            <button onclick="testServer()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
            <button onclick="testAuth()">2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</button>
            <button onclick="testAPI()">3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
            <button onclick="testFullFlow()">4. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h3>üîç –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å:</h3>
            <div class="info">
                <p><strong>–ï—Å–ª–∏ –≤—ã –ù–ï –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É:</strong></p>
                <ul>
                    <li>–ü–æ—è–≤–∏—Ç—Å—è —Å–∏–Ω—è—è –∫–∞—Ä—Ç–æ—á–∫–∞ "–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É"</li>
                    <li>–ö–Ω–æ–ø–∫–∏ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –±—É–¥—É—Ç –æ—Ç–∫–ª—é—á–µ–Ω—ã</li>
                    <li>–ü—Ä–∏ –∫–ª–∏–∫–µ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ª–æ–≥–∏–Ω</li>
                </ul>
            </div>

            <div class="success">
                <p><strong>–ï—Å–ª–∏ –≤—ã –í–û–®–õ–ò –≤ —Å–∏—Å—Ç–µ–º—É:</strong></p>
                <ul>
                    <li>–ü–æ–ª–µ –≤–≤–æ–¥–∞ –∞–∫—Ç–∏–≤–Ω–æ</li>
                    <li>–ö–Ω–æ–ø–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã</li>
                    <li>–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "typing" –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä</li>
                    <li>AI –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ</li>
                    <li>–ù–ï–¢ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üêõ –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
            <div class="warning">
                <p><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console):</strong></p>
                <ul>
                    <li>–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å "‚ùå" –∏–ª–∏ "Error"</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSRF —Ç–æ–∫–µ–Ω</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç—ã API</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
            <button onclick="checkStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            <div id="statusResult"></div>
        </div>

        <script>
            function log(message, type = 'info') {
                const results = document.getElementById('testResults');
                const timestamp = new Date().toLocaleTimeString();
                const colors = {
                    success: '#4CAF50',
                    error: '#f44336',
                    warning: '#ff9800',
                    info: '#2196F3'
                };
                results.innerHTML += `<div style="color: ${colors[type] || colors.info}">[${timestamp}] ${message}</div>`;
                results.scrollTop = results.scrollHeight;
            }

            async function testServer() {
                log('–ü—Ä–æ–≤–µ—Ä—è—é —Å–µ—Ä–≤–µ—Ä...', 'info');
                try {
                    const response = await fetch('/api/chatbot/sessions/', { method: 'GET' });
                    if (response.status === 401) {
                        log('‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.', 'success');
                    } else if (response.status === 200) {
                        log('‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!', 'success');
                    } else {
                        log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status, 'error');
                    }
                } catch (error) {
                    log('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç: ' + error.message, 'error');
                }
            }

            async function testAuth() {
                log('–ü—Ä–æ–≤–µ—Ä—è—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...', 'info');
                try {
                    const response = await fetch('/api/chatbot/sessions/', { method: 'GET' });
                    if (response.status === 401) {
                        log('‚ö†Ô∏è –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: http://127.0.0.1:8000/login/', 'warning');
                    } else if (response.status === 200) {
                        log('‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    }
                } catch (error) {
                    log('‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ' + error.message, 'error');
                }
            }

            async function testAPI() {
                log('–ü—Ä–æ–≤–µ—Ä—è—é API...', 'info');
                try {
                    const response = await fetch('/api/chatbot/chat/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: 'Test message' })
                    });

                    if (response.status === 401) {
                        log('‚ö†Ô∏è API —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.', 'warning');
                    } else if (response.status === 200) {
                        const data = await response.json();
                        log('‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—Ç–≤–µ—Ç: ' + data.bot_message.content.substring(0, 50) + '...', 'success');
                    } else {
                        log('‚ùå API –æ—à–∏–±–∫–∞: ' + response.status, 'error');
                    }
                } catch (error) {
                    log('‚ùå API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç: ' + error.message, 'error');
                }
            }

            async function testFullFlow() {
                log('–ó–∞–ø—É—Å–∫–∞—é –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç...', 'info');

                try {
                    // Test auth
                    const authResponse = await fetch('/api/chatbot/sessions/');
                    if (authResponse.status === 401) {
                        log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                        return;
                    }

                    // Test API
                    const apiResponse = await fetch('/api/chatbot/chat/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: '–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ–∂—É –æ—Ç —Å–æ–ª–Ω—Ü–∞?' })
                    });

                    if (apiResponse.status === 200) {
                        const data = await apiResponse.json();
                        log('‚úÖ –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! AI –æ—Ç–≤–µ—Ç–∏–ª: ' + data.bot_message.content.substring(0, 60) + '...', 'success');
                    } else {
                        log('‚ùå API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç: ' + apiResponse.status, 'error');
                    }
                } catch (error) {
                    log('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
                }
            }

            async function checkStatus() {
                const statusDiv = document.getElementById('statusResult');
                statusDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è—é...';

                try {
                    const response = await fetch('/api/chatbot/sessions/');
                    if (response.status === 401) {
                        statusDiv.innerHTML = '<div style="color: #ff9800;">‚ö†Ô∏è –ù—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É<br><a href="http://127.0.0.1:8000/login/" style="color: #ffeb3b;">–í–æ–π—Ç–∏ —Å–µ–π—á–∞—Å</a></div>';
                    } else if (response.status === 200) {
                        statusDiv.innerHTML = '<div style="color: #4CAF50;">‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!<br><a href="http://127.0.0.1:8000/chatbot/" style="color: #ffeb3b;">–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç</a></div>';
                    } else {
                        statusDiv.innerHTML = '<div style="color: #f44336;">‚ùå –û—à–∏–±–∫–∞: ' + response.status + '</div>';
                    }
                } catch (error) {
                    statusDiv.innerHTML = '<div style="color: #f44336;">‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç</div>';
                }
            }

            // Auto-check on load
            window.addEventListener('load', function() {
                console.log('Debug page loaded');
                setTimeout(checkStatus, 1000);
            });
        </script>

        <div id="testResults"></div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="http://127.0.0.1:8000/login/" style="background: #4CAF50; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-size: 16px;">üöÄ –ù–∞—á–∞—Ç—å</a>
            <a href="http://127.0.0.1:8000/chatbot/" style="background: #2196F3; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-size: 16px; margin-left: 10px;">üí¨ –ß–∞—Ç</a>
        </div>
    </div>
</body>
</html>
